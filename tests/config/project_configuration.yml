fallback_dir: "fallback_data"

dportal:
  filename: "dportal_{}.xml"
  limit: 1000
  url: "http://d-portal.org/dquery?form=xml&sql=%s"
  query: "
SELECT * FROM xson WHERE root = '/iati-activities/iati-activity' AND
    (xson->>'/reporting-org@secondary-reporter'='0' OR xson->>'/reporting-org@secondary-reporter'='' OR
    xson->>'/reporting-org@secondary-reporter' IS NULL) AND aid IN (
    SELECT aid FROM xson WHERE
    (
        root='/iati-activities/iati-activity/humanitarian-scope' AND
        xson->>'@type'='1' AND
        xson->>'@vocabulary'='1-2' AND
        xson->>'@code'='EP-2020-000012-001'
    ) OR (
        root='/iati-activities/iati-activity/humanitarian-scope' AND
        xson->>'@type'='2' AND
        xson->>'@vocabulary'='2-1' AND
        xson->>'@code'='HCOVD20'
    ) OR (
        root='/iati-activities/iati-activity/tag' AND
        xson->>'@vocabulary'='99' AND
        xson->>'@vocabulary-uri' IS NULL AND
        UPPER(xson->>'@code')='COVID-19'
    ) OR (
        root='/iati-activities/iati-activity/title/narrative' AND
        to_tsvector('simple', xson->>'') @@ to_tsquery('simple','COVID | CORONAVIRUS')
    ) OR (
        root='/iati-activities/iati-activity/description/narrative' AND
        to_tsvector('simple', xson->>'') @@ to_tsquery('simple','COVID | CORONAVIRUS')
    ) OR (
        root='/iati-activities/iati-activity/transaction/description/narrative' AND
        to_tsvector('simple', xson->>'') @@ to_tsquery('simple','COVID | CORONAVIRUS')
    ) OR (
        root='/iati-activities/iati-activity/sector' AND
        xson->>'@code'='12264' AND
        (xson->>'@vocabulary'='1' OR xson->>'@vocabulary'='' OR xson->>'@vocabulary' IS NULL)
    ) OR (
        root='/iati-activities/iati-activity/transaction/sector' AND
        xson->>'@code'='12264' AND
        (xson->>'@vocabulary'='1' OR xson->>'@vocabulary'='' OR xson->>'@vocabulary' IS NULL)
    ) GROUP BY aid ORDER BY max(xson->>'@iati-activities:generated-datetime'), max(xson->>'@last-updated-datetime'), aid {}
)"

outputs:
  folder: output
  transactions:
    json: "transactions.json"
    csv: "transactions.csv"
    headers:
      - "Month"
      - "Reporting org"
      - "Reporting org type"
      - "Sector"
      - "Recipient country"
      - "Humanitarian?"
      - "Strict?"
      - "Transaction type"
      - "Activity id"
      - "Net money"
      - "Total money"
    hxltags:
      - "#date+month"
      - "#org+name"
      - "#org+type"
      - "#sector"
      - "#country"
      - "#indicator+bool+humanitarian"
      - "#indicator+bool+strict"
      - "#x_transaction_type"
      - "#activity+code"
      - "#value+net"
      - "#value+total"
  flows:
    json: "flows.json"
    csv: "flows.csv"
    headers:
      - "Reporting org"
      - "Reporting org type"
      - "Provider org"
      - "Receiver org"
      - "Humanitarian?"
      - "Strict?"
      - "Transaction type"
      - "Transaction direction"
      - "Total money"
    hxltags:
      - "#org+name+reporting"
      - "#org+reporting+type"
      - "#org+name+provider"
      - "#org+name+receiver"
      - "#indicator+bool+humanitarian"
      - "#indicator+bool+strict"
      - "#x_transaction_type"
      - "#x_transaction_direction"
      - "#value+total"

filters:
  reporting_orgs:
    - "CZ-ICO-25755277" # People in Need: https://iatiregistry.org/publisher/pin
  reporting_orgs_with_children:  # where hierarchy=1
    - "XM-DAC-41114"  # UNDP
    - "GB-GOV-1"  # FCDO

lookups:
  org_data: "data/IATIOrganisationIdentifier.json"
  sector_data: "data/dac3-sector-map.json"
  default_org: "(unspecified org)"
  default_sector: "(Unspecified sector)"
  default_country: "(Unspecified country)"
  rates_url: "https://codeforiati.org/exchangerates-scraper/consolidated.csv"
  fallback_rates_url: "https://api.exchangerate.host/latest?base=usd"

calculate_splits:
  default_sector: "99999"
  default_country: "XX"

transaction_type_info:
  "1":
    label: "Incoming Funds"
    classification: "spending"
    direction: "incoming"
  "2":
    label: "Outgoing Commitment"
    classification: "commitments"
    direction: "outgoing"
  "3":
    label: "Disbursement"
    classification: "spending"
    direction: "outgoing"
  "4":
    label: "Expenditure"
    classification: "spending"
    direction: "outgoing"
  "11":
    label: "Incoming Commitment"
    classification: "commitments"
    direction: "incoming"
